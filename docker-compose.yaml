version: '3'

services:
  compiler:
    image: ethereum/solc:0.8.17
    volumes:
      - ./contracts:/contracts
    command: --output-dir /contracts/build --overwrite --abi --bin /contracts/HelloWorld.sol

  deployer:
    image: ethereum/solc:0.8.17
    volumes:
      - ./build:/build
      - ./deploy:/deploy
    command: --abi /build/*.abi --bin /build/*.bin --optimize --overwrite --combined-json abi,bin,bin-runtime,srcmap,srcmap-runtime,ast,metadata /deploy/*.sol

  abi-gen:
    build:
      context: .
      dockerfile: docker/Dockerfile
    volumes:
      - ./contracts:/contracts
      - ./internal:/internal
    command: abigen --abi /contracts/build/HelloWorld.abi --pkg contract --out /internal/pkg/contract/hello_world.go